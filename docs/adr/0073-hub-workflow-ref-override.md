# ADR-0073: Hub Workflow Ref Override for Audit Branches

**Status**: Accepted  
**Date:** 2026-01-26  
**Developer:** Justin Guida  
**Last Reviewed:** 2026-01-26  

## Context

Caller workflows generated by `cihub init` pin the reusable workflow at `@v1`.
This keeps production stable but blocks audit runs from exercising workflow
changes on audit branches. `--hub-ref` only controls the CLI install inside
the workflow; it does not change the reusable workflow ref, so artifact upload
fixes cannot be validated in real repos.

We need a CLI-first, schema-backed way to override the reusable workflow ref
for audit branches without moving the `v1` tag or hand-editing YAML.

## Decision

Add an optional config field `repo.hub_workflow_ref` and a CLI flag
`--hub-workflow-ref` on `cihub init`/`update` (and setup passthrough) that:

- Pins the reusable workflow ref in generated `hub-ci.yml`.
- Defaults to the template ref when unset (no behavior change).
- Uses the override as a fallback for HUB_REF when setting repo vars if
  `--hub-ref` is not provided (keeps audit runs aligned by default).

This enables audit branches to exercise workflow changes and artifact uploads
without changing global template defaults or moving release tags.

## Consequences

### Positive

- Audit runs can validate workflow changes before release tags are updated.
- Real repos can verify `cihub triage --verify-tools` without YAML edits.
- Keeps `@v1` immutable and production callers stable.

### Negative

- Adds a new optional field to the repo schema.
- Adds a new CLI flag that must be documented and tested.

## Alternatives Considered

1. Move `v1` to the audit branch.  
   Rejected: breaks immutable release expectations and causes drift.
2. Change templates to use `@main`.  
   Rejected: destabilizes production and violates release pin policy.
3. Manual YAML edits in audit repos.  
   Rejected: violates CLI-first rule and introduces drift.
