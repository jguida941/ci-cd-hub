# CIHub Tool Test Audit Plan

**Status:** active
**Owner:** Development Team
**Source-of-truth:** manual
**Last-reviewed:** 2026-01-26

## Purpose

Define a CLI-first, evidence-based plan to validate every tool and command
surface across representative repo shapes before fixing tool failures.

## Scope

- Python CLI command surfaces (core, config, docs, report, triage, dispatch).
- Tool runners for Python and Java (registry-driven list).
- TypeScript CLI passthrough and wizard handoff flows.
- Workflow wrappers generated by the CLI only (no manual YAML edits).

## Non-goals

- Repo-specific patches that cannot be generalized via schema/config/detection.
- Adding new tools or changing CLI surface area (tracked via ADR + schema).
- Replacing the existing audit logs (this plan drives them).

## Source lists and logs

- Tool registry: `docs/reference/TOOLS.md` and `cihub tools list --json`.
- Audit log: `docs/development/research/CIHUB_TOOL_RUN_AUDIT.md`.
- TS CLI audit log: `docs/development/research/TS_CLI_FULL_AUDIT_2026-01-19.md`.
- Prior research plan: `docs/development/research/CIHUB_FULL_AUDIT_PLAN.md`.

## Tool coverage (registry snapshot)

Python tools:
pytest, ruff, black, isort, mypy, bandit, pip_audit, sbom, semgrep, trivy,
codeql, docker, hypothesis, mutmut.

Java tools:
jacoco, pitest, jqwik, checkstyle, spotbugs, pmd, owasp, semgrep, trivy,
codeql, sbom, docker.

## Repo matrix

- Python: cihub-test-python-pyproject, cihub-test-python-src-layout,
  cihub-test-python-setup.
- Java: cihub-test-java-maven, cihub-test-java-gradle,
  cihub-test-java-multi-module.
- Monorepo: cihub-test-monorepo (python + java targets).
- GUI/Qt: gitui (headless).
- Orchestrator: ci-cd-hub-fixtures, ci-cd-hub-canary-python,
  ci-cd-hub-canary-java.
- Hub: jguida941/ci-cd-hub (self-check).

## Real repo audit (owner inventory)

- Inventory with `gh repo list jguida941 --limit 200 --json name,defaultBranchRef,isArchived,isPrivate,visibility`.
- Exclude archived or fork-only repos; prioritize active repos with CI signals.
- For each repo:
  - Create an audit branch (e.g., `audit/cihub-audit-YYYY-MM-DD`).
  - Regenerate via `cihub init --apply --force` (no manual YAML edits).
  - Use `--hub-workflow-ref <audit-ref>` (and `--hub-ref`) when validating
    workflow changes before a release tag is updated.
  - Dispatch and triage (`cihub dispatch trigger/watch`, `cihub triage --verify-tools`).
  - If no artifacts, treat as a failure and fix the workflow/CLI before moving on.
- Log every run in `docs/development/research/CIHUB_TOOL_RUN_AUDIT.md`.

## Evidence rules

- `tools_ran` means the command executed.
- `tools_success` means the tool ran and passed gates.
- `tool_evidence` is required for success: report artifacts and metrics.
- Missing `tools_success` is treated as unknown: warn in triage, fail in
  `cihub triage --verify-tools`.

## Audit phases

1. Inventory and mapping
   - Generate the tool list from the registry.
   - Map tools to repo shapes and expected artifacts/metrics.
2. Baseline CLI passes (per repo)
   - `cihub detect`, `cihub init --apply`, `cihub validate`,
     `cihub config-outputs`, `cihub ci`.
3. Tool-by-tool validation
   - `cihub run <tool>` for each registry tool.
   - `cihub report validate` and `cihub triage --verify-tools` must pass.
4. TS CLI and wizard parity
   - Run key commands via `cihub-cli` and wizard flows (`init`, `new`,
     `config edit`) and compare outputs with the Python CLI.
5. Fix loop and re-validation
   - If any tool fails or lacks evidence, fix the CLI and re-run the same
     repo/tool before advancing.

## Command checklist

- Core CLI: `cihub detect`, `cihub init`, `cihub update`, `cihub ci`,
  `cihub run <tool>`, `cihub check`, `cihub validate`, `cihub config-outputs`.
- Docs: `cihub docs generate`, `cihub docs check`, `cihub docs stale`,
  `cihub docs audit`.
- Report/triage: `cihub report validate`, `cihub report summary`,
  `cihub report aggregate`, `cihub triage --latest --verify-tools`.
- Dispatch: `cihub dispatch trigger`, `cihub dispatch watch`.

## Prereqs

- GitHub auth via env token or `gh auth token`.
- Optional NVD API key for OWASP (absence should still produce evidence).
- Required tool binaries available on the runner (or installed by cihub).

## Exit criteria

- Every tool in the registry is verified with evidence across the repo matrix.
- `cihub triage --verify-tools` returns zero unknown or no-report statuses.
- TS CLI and wizard flows match Python CLI behavior.
- Repeatable green runs on fixtures and canaries without manual workflow edits.
